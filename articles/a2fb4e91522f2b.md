---
title: "Python ftplib FTPæ“ä½œ"
emoji: "ğŸ‘»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python", "ftp"]
published: true
---
# Python ftplibã®FTPæ“ä½œ
å…¬å¼
https://docs.python.org/ja/3/library/ftplib.html

## æ¥ç¶šã™ã‚‹
~~~python
import ftplib

ftp = ftplib.FTP()
ftp.connect('xxx.xxx.xxx.xxx', port=21, timeout=60)
msg = ftp.login('user', 'password')
~~~
`ftp.login(user, password)`ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™ã€‚æˆåŠŸã™ã‚‹ã¨ã€
>230 User ãƒ¦ãƒ¼ã‚¶ãƒ¼å logged in

FTP Response Codeã®ä¸€è¦§ã¯ã“ã¡ã‚‰
https://en.wikipedia.org/wiki/List_of_FTP_server_return_codes

Passive/Activeã®è¨­å®šã¯ã“ã†ã™ã‚‹ã€‚DefaultãŒPassiveãªã®ã§Trueãªã‚‰çœç•¥ã€‚
~~~python
ftp.set_pasv(True)
~~~

## Directoryã¨Fileã‚’ç¢ºèª
~~~python
# ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—
ftp_current_dir = ftp.pwd()

# ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç§»å‹•
ftp.cwd('/foo/bar')

# ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸€è¦§ã‚’ãƒªã‚¹ãƒˆã§å–å¾—
file_list = ftp.nlst(".")
~~~
ãƒ•ã‚¡ã‚¤ãƒ«ã‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã€ç­‰ã®è©³ç´°ãŒã»ã—ã„å ´åˆã¯mlsd
~~~python
mlsd = ftp.mlsd(".")  # generatorãŒè¿”ã£ã¦ãã‚‹
for i in mlsd:
    print(str(i))
~~~
~~~
('.', {'modify': '2022xxxxxxxxxx', 'perm': 'flcdmpe', 'type': 'cdir', 'unique': 'xxx', 'unix.group': '1000', 'unix.groupname': 'users', 'unix.mode': '0705', 'unix.owner': '1232', 'unix.ownername': 'xxx'})     
('..', {'modify': '2022xxxxxxxxxx', 'perm': 'flcdmpe', 'type': 'pdir', 'unique': 'xxx', 'unix.group': '1000', 'unix.groupname': 'users', 'unix.mode': '0700', 'unix.owner': '1232', 'unix.ownername': 'xxx'})    
('file.jpg', {'modify': '2022xxxxxxxxxx', 'perm': 'adfrw', 'size': '2275', 'type': 'file', 'unique': 'xxx', 'unix.group': '1000', 'unix.groupname': 'users', 'unix.mode': '0604', 'unix.owner': '1232', 'unix.ownername': 'xxx'})
('dir', {'modify': '2022xxxxxxxxxx', 'perm': 'flcdmpe', 'type': 'dir', 'unique': 'xxx', 'unix.group': '1000', 'unix.groupname': 'users', 'unix.mode': '0705', 'unix.owner': '1232', 'unix.ownername': 'xxx'})
~~~

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€å‰Šé™¤
~~~python
# upload
with open('C:/upload/suru/file.jpg', "rb") as f:
    ftp.storbinary("STOR ./upload/sakino/dir/to/file_name.txt', f)

# download
with open('C:/download/surudir/file.jpg', 'wb') as f:
    ftp.retrbinary('RETR file.jpg', f.write)

# delete
ftp.delete(file.jpg)
~~~
